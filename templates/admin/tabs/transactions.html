<!-- تب «تراکنش‌ها» -->
<h2 style="margin-bottom:20px">تاریخچه تراکنش‌های مالی</h2>

<form method="get" action="/admin/all-transactions" style="display:flex;gap:5px;margin-bottom:10px">
    <input type="text" name="transaction_search" placeholder="جستجوی نام کاربری…" value="{{ transaction_search or '' }}" style="flex-grow:1">
    <button type="submit" style="width:auto">جستجو</button>
</form>

<table data-datatables>
    <thead>
        <tr>
            <th>کاربر</th>
            <th>تاریخ (تهران)</th>
            <th>شرح</th>
            <th>مبلغ (ریال)</th>
        </tr>
    </thead>
    <tbody>
        {% for t in transactions %}
        <tr>
            <td>{{ t.user.username }}</td>
            <td>{{ t.timestamp_shamsi.strftime('%Y/%m/%d %H:%M') }}</td>
            <td>{{ t.description }}</td>
            <td style="color:{% if t.amount<0 %}red{% else %}green{% endif %};font-weight:bold;direction:ltr">
                {{ "{:,.0f}".format(t.amount) }}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if trans_total_pages>1 %}
<div class="pagination">
    <a href="?transaction_search={{ transaction_search or '' }}&page={{ trans_current_page-1 }}" class="{% if trans_current_page<=1 %}disabled{% endif %}">قبلی</a>
    <span class="current">صفحه {{ trans_current_page }} از {{ trans_total_pages }}</span>
    <a href="?transaction_search={{ transaction_search or '' }}&page={{ trans_current_page+1 }}" class="{% if trans_current_page>=trans_total_pages %}disabled{% endif %}">بعدی</a>
</div>
{% endif %}
