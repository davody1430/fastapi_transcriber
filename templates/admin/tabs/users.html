<!-- ุชุจ ยซูุฏุฑุช ฺฉุงุฑุจุฑุงูยป -->
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
    <h2>ูุฏุฑุช ฺฉุงุฑุจุฑุงู</h2>
</div>

<!-- ๐ flex-wrap ุงูุฒูุฏู ุดุฏ ุชุง ูุฑู ุจุฑูู ูุฒูุฏ -->
<div style="display:flex;gap:30px;flex-wrap:wrap">
    <!-- ูุฑู ุงุฌุงุฏ ฺฉุงุฑุจุฑ -->
    <div class="panel" style="width:350px;min-width:300px">
        <h3>ุงุฌุงุฏ ฺฉุงุฑุจุฑ ุฌุฏุฏ</h3>

        {% if error %}
        <div style="background:#f8d7da;color:#721c24;padding:1rem;border:1px solid #f5c6cb;border-radius:.25rem;margin-bottom:1rem">
            {{ error }}
        </div>
        {% endif %}

        <form action="/admin/create_user" method="post" style="display:flex;flex-direction:column;gap:10px">
            <label for="username">ูุงู ฺฉุงุฑุจุฑ:</label>
            <input type="text" id="username" name="username" required>

            <label for="password">ุฑูุฒ ุนุจูุฑ:</label>
            <input type="password" id="password" name="password" required>

            <label for="role">ููุด:</label>
            <select id="role" name="role">
                <option value="employee">ฺฉุงุฑููุฏ</option>
                <option value="customer">ูุดุชุฑ</option>
                <option value="admin">ูุฏุฑ</option>
            </select>

            <label for="file_limit">ูุญุฏูุฏุช ุฑูุฒุงูู ูุงู:</label>
            <input type="number" id="file_limit" name="file_limit" value="5" required>

            <label for="wallet_balance">ุงุนุชุจุงุฑ ุงููู (ุฑุงู):</label>
            <input type="number" id="wallet_balance" name="wallet_balance" value="0" required>

            <label for="token_price">ููุช ูุฑ ุชูฺฉู (ุฑุงู):</label>
            <input type="number" step="any" id="token_price" name="token_price" value="10" required>

            <button type="submit" style="margin-top:10px">ุงุฌุงุฏ ฺฉุงุฑุจุฑ</button>
        </form>
    </div>

    <!-- ุฌุฏูู ฺฉุงุฑุจุฑุงู -->
    <div class="panel" style="flex:1;max-height:600px;overflow-y:auto">
        <h3>ููุฑุณุช ฺฉุงุฑุจุฑุงู</h3>
        <form method="get" action="/admin/manage-users" style="display:flex;gap:5px;margin-bottom:10px">
            <input type="text" name="user_search" placeholder="ุฌุณุชุฌู ูุงู ฺฉุงุฑุจุฑ..." value="{{ user_search or '' }}" style="flex-grow:1">
            <button type="submit" style="width:auto">ุฌุณุชุฌู</button>
        </form>

        <table data-datatables>
            <thead>
                <tr>
                    <th>ูุงู ฺฉุงุฑุจุฑ</th>
                    <th>ููุด</th>
                    <th>ููุฌูุฏ (ุฑุงู)</th>
                    <th>ููุช ุชูฺฉู</th>
                    <th>ุนููุงุช</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>{{ u.username }}</td>
                    <td>
                        {% if u.role.name == 'admin' %}ูุฏุฑ
                        {% elif u.role.name == 'employee' %}ฺฉุงุฑููุฏ
                        {% else %}ูุดุชุฑ{% endif %}
                    </td>
                    <td>{{ "{:,.0f}".format(u.wallet_balance) }}</td>
                    <td>{{ u.token_price }}</td>
                    <td><a href="/admin/users/{{ u.id }}/profile">ูุดุงูุฏู ูพูู</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function showToast(msg){
  Toastify({text:msg,duration:5000,gravity:"bottom",position:"center",backgroundColor:'#4CAF50'}).showToast();
}
document.addEventListener('DOMContentLoaded',()=>{
  const p=new URLSearchParams(location.search).get('msg');
  if(p==='user-created'){
      showToast('ฺฉุงุฑุจุฑ ุฌุฏุฏ ุจุง ููููุช ุงุฌุงุฏ ุดุฏ.');
      history.replaceState({},'',location.pathname);
  }
});
</script>
